class String
  def red;            "\e[31m#{self}\e[0m" end
end

class Game < String

def initialize
  @contents = File.readlines('dictionary.txt')
  @word = ""
  @misses = ""
  @guesses = ""
  @tries = 8
  @game_over = false
  new_word
  play
end

private

def new_word
  until @word.size > 4 && @word.size < 13
    @word=@contents.sample.chomp
  end
  @clues = @word.tr("a-z", "_").split("")
end
  

def play
  clues
  check_guess
end

def clues
  puts "#{@clues.join} \nNumber of letters: #{@clues.size}"
  puts "Number of tries remaining : #{@tries}"
  puts "Misses : #{@misses}"
end

def check_guess
  check_endgame
  until @game_over
    puts "\nPlease enter a letter"
    @guess=gets.chomp.downcase
    if @guess.length == 1
      @word.split("").each_with_index do |letter, index|
        if letter.match?(@guess)
          @clues[index] = @guess
          @guesses += @guess
        end
      end
    else
      error
    end
    wrong_letters(@guess)
    play
  end
end

def wrong_letters(char)
  if @guesses.include?(char)
    return
  else
    @misses += char.red + " "
    @tries -= 1
  end
end

def check_endgame
  if @clues.none? {|element| element == "_"}
    @game_over = true
    puts "Sorry, you won..."
  elsif @tries == 0
    @game_over = true
    puts "Congratulations, you lost ! The word you were looking for was : #{@word}"
    return
  end
end

def error
  puts "Erroneous input! Try again..."
  check_guess
end

end

Game.new
